//Xbee TX setup:
#include <SoftwareSerial.h>
#define rxPin 2 //DOUT --> PIN 2
#define txPin 3 //DIN --> PIN 3
SoftwareSerial xbee = SoftwareSerial(rxPin, txPin);


/*************************************************************************************/
/*To generate frames in XCTU API Frames Generator
Mode API 1
Frame Type: 0x17
Frame ID: 01
64-bit dest address: radio address
16-bit dest address: FF FE
Remote cmd. options: 02
AT command (hex):   _ON: 64 31
                    _OFF: 66 72
Parameter Value(hex):  _ON:  05
                       _OFF: NOT USED
*/

//Our frames to send:
// A4 is on DS1 2/17/2021
byte estop_ON_DS1[] = {0x7E, 0x00, 0x10, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x70, 0xc2, 0xFF, 0xFE, 0x02, 0x64, 0x31, 0x05, 0x9d};
byte estop_OFF_DS1[] = {0x7E, 0x00, 0x0f, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x70, 0xc2, 0xFF, 0xFE, 0x02, 0x66, 0x72, 0x5f};

// A5 is on DS2 2/17/2021
byte estop_ON_DS2[] = {0x7E, 0x00, 0x10, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x6f, 0xbe, 0xFF, 0xFE, 0x02, 0x64, 0x31, 0x05, 0xa2};
byte estop_OFF_DS2[] = {0x7E, 0x00, 0x0f, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x6f, 0xbe, 0xFF, 0xFE, 0x02, 0x66, 0x72, 0x64};

// A6 is on DS3 2/17/2021
byte estop_ON_DS3[] = {0x7E, 0x00, 0x10, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x33, 0xD6, 0xFF, 0xFE, 0x02, 0x64, 0x31, 0x05, 0xc6};
byte estop_OFF_DS3[] = {0x7E, 0x00, 0x0f, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x33, 0xD6, 0xFF, 0xFE, 0x02, 0x66, 0x72, 0x88};

// A7 is on DS4 2/17/2021
byte estop_ON_DS4[] = {0x7E, 0x00, 0x10, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x34, 0x04, 0xFF, 0xFE, 0x02, 0x64, 0x31, 0x05, 0x97};
byte estop_OFF_DS4[] = {0x7E, 0x00, 0x0F, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x34, 0x04, 0xFF, 0xFE, 0x02, 0x66, 0x72, 0x59};

// B2 is on Canary 1 2/17/2021
byte estop_ON_C1[] = {0x7E, 0x00, 0x10, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0xc9, 0xbd, 0xc0, 0xFF, 0xFE, 0x02, 0x64, 0x31, 0x05, 0x12};
byte estop_OFF_C1[] = {0x7E, 0x00, 0x0F, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0xc9, 0xbd, 0xc0, 0xFF, 0xFE, 0x02, 0x66, 0x72, 0xd4};

// A9 is on Canary 2 9/13/2021
byte estop_ON_C2[] = {0x7E, 0x00, 0x10, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x0f, 0xe5, 0xFF, 0xFE, 0x02, 0x64, 0x31, 0x05, 0xdb};
byte estop_OFF_C2[] = {0x7E, 0x00, 0x0F, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x0f, 0xe5, 0xFF, 0xFE, 0x02, 0x66, 0x72, 0x9d};

//  B5 is on Canary 3 9/13/2021
byte estop_ON_C3[] = {0x7E, 0x00, 0x10, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0xba, 0xc2, 0xc8, 0xFF, 0xFE, 0x02, 0x64, 0x31, 0x05, 0x14};
byte estop_OFF_C3[] = {0x7E, 0x00, 0x0F, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0xba, 0xc2, 0xc8, 0xFF, 0xFE, 0x02, 0x66, 0x72, 0xd6};

////// OLD /////////////////////////////

// byte estop_ON_A3[] = {0x7E, 0x00, 0x10, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x08, 0xC4, 0xFF, 0xFE, 0x02, 0x44, 0x31, 0x05, 0x23};
// byte estop_OFF_A3[] = {0x7E, 0x00, 0x10, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x08, 0xC4, 0xFF, 0xFE, 0x02, 0x44, 0x31, 0x04, 0x24};


//byte estop_ON_A5[] = {0x7E, 0x00, 0x10, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x33, 0xD6, 0xFF, 0xFE, 0x02, 0x44, 0x31, 0x05, 0xE6};
//byte estop_OFF_A5[] = {0x7E, 0x00, 0x10, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x33, 0xD6, 0xFF, 0xFE, 0x02, 0x44, 0x31, 0x04, 0xE7};

//7E 00 11 17 01 00 13 A2 00 41 89 33 D6 FF FE 02 64 31 30 35 66
//7E 00 11 17 01 00 13 A2 00 41 89 33 D6 FF FE 02 64 31 30 34 67
// byte estop_ON_A8[] = {0x7E, 0x00, 0x10, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x0E, 0xEE, 0xFF, 0xFE, 0x02, 0x44, 0x31, 0x05, 0xF3};
// byte estop_OFF_A8[] = {0x7E, 0x00, 0x10, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x0E, 0xEE, 0xFF, 0xFE, 0x02, 0x44, 0x31, 0x04, 0xF4};

// byte estop_OFF_A10[] = {0x7E, 0x00, 0x11, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x0F, 0x43, 0xFF, 0xFE, 0x02, 0x44, 0x31, 0x30, 0x35, 0x1D};
//7E 00 11 17 01 00 13 A2 00 41 89 0F 43 FF FE 02 64 31 30 35 1D
// byte estop_ON_A10[] = {0x7E, 0x00, 0x11, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x0F, 0x43, 0xFF, 0xFE, 0x02, 0x44, 0x31, 0x30, 0x34, 0x1E};
//7E 00 11 17 01 00 13 A2 00 41 89 0F 43 FF FE 02 64 31 30 34 1E

// byte estop_ON_A12[] = {0x7E, 0x00, 0x11, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0xA1, 0x1A, 0x5E, 0xFF, 0xFE, 0x02, 0x44, 0x31, 0x05, 0x5F};
// byte estop_OFF_A12[] = {0x7E, 0x00, 0x11, 0x17, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0xA1, 0x1A, 0x5E, 0xFF, 0xFE, 0x02, 0x44, 0x31, 0x04, 0x60};
//7E 00 11 17 01 00 13 A2 00 41 A1 1A 5E FF FE 02 44 31 30 35 FF
//7E 00 11 17 01 00 13 A2 00 41 A1 1A 5E FF FE 02 44 31 30 35 FF

/*************************************************************************************/
byte test_b[] = {0x7E, 0x00, 0x12, 0x10, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x90, 0x8A, 0x87, 0xFF, 0xFE, 0x00, 0x00, 0x74, 0x65, 0x73, 0x74, 0x9A};

byte test_c[] = {0x7E, 0x00, 0x12, 0x10, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x89, 0x0E, 0xEE, 0xFF, 0xFE, 0x00, 0x00, 0x74, 0x65, 0x73, 0x74, 0xB6};

byte test_d[] = {0x7E, 0x00, 0x12, 0x10, 0x01, 0x00, 0x13, 0xA2, 0x00, 0x41, 0x90, 0x89, 0xB2, 0xFF, 0xFE, 0x00, 0x00, 0x74, 0x65, 0x73, 0x74, 0x70};

byte test2[] = {0x74 , 0x65 , 0x73 , 0x74}; 
void setup() {
  Serial.begin(9600);
  Serial.println("Remote E-Stop");

  //xbee setup
  pinMode(rxPin, INPUT);
  pinMode(txPin, OUTPUT);
  xbee.begin(9600);

  //Switch setup
  pinMode(8, INPUT_PULLUP);

  pinMode(LED_BUILTIN, OUTPUT);
}

void loop() {

  int switchValue = LOW;
  int lastValue = switchValue;
  int light = 1;
  Serial.println("in loop");
  
    if(light)
    {
      digitalWrite(LED_BUILTIN, HIGH);
    }
    else
    {
      digitalWrite(LED_BUILTIN, LOW);
    }
    light = light ^ 1;
    //switchValue = digitalRead(8);
    //Serial.println(switchValue, DEC);
    // Serial.println("Remote E-Stop");
    

    
      // xbee.write("/n/r",2);
    xbee.write(test_b,22);
    xbee.write(test_c,22);
    xbee.write(test_d,22);
    delay(500);
  
  

}
